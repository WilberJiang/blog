(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{191:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"socket-io"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#socket-io","aria-hidden":"true"}},[t._v("#")]),t._v(" Socket.io")]),t._v(" "),a("h2",{attrs:{id:"session-store"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#session-store","aria-hidden":"true"}},[t._v("#")]),t._v(" session store")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("客户端cookie长度有限")])]),t._v(" "),a("li",[a("p",[t._v("客户端保存cookie信息不安全")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("客户端保存钥匙，服务器存储数据")])])])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" store "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sess"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sess\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("destroy")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n  \n  app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("session")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("h2",{attrs:{id:"核心思想socket-io"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心思想socket-io","aria-hidden":"true"}},[t._v("#")]),t._v(" 核心思想socket.io")]),t._v(" "),a("ul",[a("li",[t._v("轮询ajax(setInterval(发ajax))   "),a("strong",[t._v("缺点:不停询问服务器，浪费性能")])]),t._v(" "),a("li",[t._v("服务器不关闭连接，一次响应，一直保持连接 "),a("strong",[t._v("缺点:只有服务器向客户端不断输出")])]),t._v(" "),a("li",[t._v("html5中出来了一个websocket   他是在原来http协议的基础上，去升级当前协议为websocket升级\n"),a("ul",[a("li",[t._v("将原本  先有请求才有响应的机制，更改成了，服务端也可以主动发请求给客户端")]),t._v(" "),a("li",[t._v("HTTP 一问一答，  TCP协议，客户端与服务器建立连接以后，就可以自由的通信了")]),t._v(" "),a("li",[t._v("缺点:"),a("strong",[t._v("有兼容性问题")]),t._v("（IE11）")])])])]),t._v(" "),a("ul",[a("li",[t._v("总结:\n"),a("ul",[a("li",[t._v("长轮询 : 客户端不停问，服务器不停回")]),t._v(" "),a("li",[t._v("长连接: 客户端一次，服务器多次（服务器向客户端单向输出）")]),t._v(" "),a("li",[t._v("ws（握手） WebSocket\n"),a("ul",[a("li",[t._v("全双工（双向工作（客户端和服务器））通信")])])])])])]),t._v(" "),a("ul",[a("li",[t._v("socket.io交互方式可能通过websocket/轮询ajax/服务器响应流(保持连接)\n"),a("ul",[a("li",[a("ol",[a("li",[t._v("服务器可主动发数据到客户端")]),t._v(" "),a("li",[t._v("客户端向客户端发数据通过服务器")])])])])])]),t._v(" "),a("h2",{attrs:{id:"下载包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载包","aria-hidden":"true"}},[t._v("#")]),t._v(" 下载包")]),t._v(" "),a("ul",[a("li",[t._v("客户端：socket.io-client")]),t._v(" "),a("li",[t._v("服务器：koa-socket")])]),t._v(" "),a("h2",{attrs:{id:"操作步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作步骤","aria-hidden":"true"}},[t._v("#")]),t._v(" 操作步骤")]),t._v(" "),a("ul",[a("li",[t._v("服务器广播   "),a("code",[t._v("io.broadcast('事件名',{ 数据} );")])]),t._v(" "),a("li",[t._v("服务器向客户端||客户端向服务器  "),a("code",[t._v("socket.emit('事件名',{数据});")])]),t._v(" "),a("li",[t._v("客户端接收  "),a("code",[t._v("socket.on('事件名',data=>{} )")])]),t._v(" "),a("li",[t._v("服务器接收  "),a("code",[t._v("io.on('事件名',data=>{});")])])]),t._v(" "),a("h2",{attrs:{id:"进阶学习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进阶学习","aria-hidden":"true"}},[t._v("#")]),t._v(" 进阶学习")]),t._v(" "),a("ul",[a("li",[t._v("私聊\n"),a("ul",[a("li",[a("ol",[a("li",[t._v("客户端告诉服务器to谁,及内容")]),t._v(" "),a("li",[t._v("服务器通过app._io.to(socket.id)找到目标客户端,再通过emit通信")])])])])]),t._v(" "),a("li",[t._v("群组聊天\n"),a("ul",[a("li",[t._v("加入群组 "),a("code",[t._v("ctx.socket.socket.join(groupid);")]),t._v(" "),a("ul",[a("li",[t._v("离开群 "),a("code",[t._v("ctx.socket.socket.leave('字符串标识')")])])])]),t._v(" "),a("li",[t._v("向群里通信"),a("code",[t._v("app._io.to(groupid).emit")])]),t._v(" "),a("li",[t._v("后续接收还是对应on('xxxx')")])])])]),t._v(" "),a("h2",{attrs:{id:"mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql","aria-hidden":"true"}},[t._v("#")]),t._v(" mysql")]),t._v(" "),a("ul",[a("li",[t._v("安装依赖包"),a("code",[t._v("npm i mysql -S")])]),t._v(" "),a("li",[t._v("查看文档")])]),t._v(" "),a("h2",{attrs:{id:"excel操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#excel操作","aria-hidden":"true"}},[t._v("#")]),t._v(" excel操作")]),t._v(" "),a("ul",[a("li",[t._v("node-xlsx  读取excel，xlsx 和xls")])]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("ul",[a("li",[t._v("第三方包的用途  koa-static 处理静态资源")]),t._v(" "),a("li",[t._v("koa-router  query获取查询字符串  params 获取 /xxx/:id 中的id")]),t._v(" "),a("li",[t._v("koa-session app.keys必须要写上作为其内部运算的标识\n"),a("ul",[a("li",[t._v("两次setcookie其中一个是cookie标识")]),t._v(" "),a("li",[t._v("一个是数据签名， 保证数据不被修改")])])]),t._v(" "),a("li",[t._v("koa-art-template 按文档配置引擎")]),t._v(" "),a("li",[t._v("koa-bodyparser 解析请求体   ctx.request.body获取数据")]),t._v(" "),a("li",[t._v("socket.io\n"),a("ul",[a("li",[t._v("客户端需要引入  socket.io-client")]),t._v(" "),a("li",[t._v("服务器： koa-socket")]),t._v(" "),a("li",[t._v("对象之间的关系和结构，都是写多就熟，也并不用很熟，看着文档，会来就行")]),t._v(" "),a("li",[t._v("客户端端与服务器之间都是  on('xxx')  emit('xxx')去对应\n"),a("ul",[a("li",[t._v("join加入组")]),t._v(" "),a("li",[t._v("to 私聊")]),t._v(" "),a("li",[t._v("事件名,数据    数据可以是对象，如果仅仅是字符串，  ctx.data拿就可以了，是对象ctx.data.xxxx")])])])])])])])}],!1,null,null,null);s.default=n.exports}}]);