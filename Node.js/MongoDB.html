<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB | Wilber-姜波</title>
    <meta name="description" content="姜波的个人网站">
    <link rel="icon" href="/blog/icon/favicon.ico">
    
    <link rel="preload" href="/blog/assets/css/0.styles.30595269.css" as="style"><link rel="preload" href="/blog/assets/js/app.cd55051b.js" as="script"><link rel="preload" href="/blog/assets/js/8.b1c62d01.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.77b360f9.js"><link rel="prefetch" href="/blog/assets/js/11.6fed2ed0.js"><link rel="prefetch" href="/blog/assets/js/12.45fcac97.js"><link rel="prefetch" href="/blog/assets/js/13.a36f0544.js"><link rel="prefetch" href="/blog/assets/js/14.09973c4a.js"><link rel="prefetch" href="/blog/assets/js/15.58167e64.js"><link rel="prefetch" href="/blog/assets/js/16.b672a490.js"><link rel="prefetch" href="/blog/assets/js/17.063d4ceb.js"><link rel="prefetch" href="/blog/assets/js/18.19d6ca7e.js"><link rel="prefetch" href="/blog/assets/js/19.6ba4fc17.js"><link rel="prefetch" href="/blog/assets/js/2.d931aa0b.js"><link rel="prefetch" href="/blog/assets/js/20.7e7fcc4e.js"><link rel="prefetch" href="/blog/assets/js/21.70d2e103.js"><link rel="prefetch" href="/blog/assets/js/22.835e718b.js"><link rel="prefetch" href="/blog/assets/js/23.783c1181.js"><link rel="prefetch" href="/blog/assets/js/24.63be1340.js"><link rel="prefetch" href="/blog/assets/js/25.f6480a6d.js"><link rel="prefetch" href="/blog/assets/js/26.04b2c4fe.js"><link rel="prefetch" href="/blog/assets/js/27.2382688e.js"><link rel="prefetch" href="/blog/assets/js/28.345960bc.js"><link rel="prefetch" href="/blog/assets/js/29.b2ceaae7.js"><link rel="prefetch" href="/blog/assets/js/3.729ebb14.js"><link rel="prefetch" href="/blog/assets/js/30.e5da16d0.js"><link rel="prefetch" href="/blog/assets/js/31.fe858abb.js"><link rel="prefetch" href="/blog/assets/js/32.0226b2b2.js"><link rel="prefetch" href="/blog/assets/js/4.8d9cff3d.js"><link rel="prefetch" href="/blog/assets/js/5.d73792fa.js"><link rel="prefetch" href="/blog/assets/js/6.0fc8d69e.js"><link rel="prefetch" href="/blog/assets/js/7.fb18cbd8.js"><link rel="prefetch" href="/blog/assets/js/9.79816390.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.30595269.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Wilber-姜波</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">技术归纳</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/HTML5/Canvas.html" class="nav-link">HTML5</a></li><li class="dropdown-item"><!----> <a href="/blog/CSS3/Background.html" class="nav-link">CSS3</a></li><li class="dropdown-item"><!----> <a href="/blog/JavaScript/Senior.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/blog/Node.js/Base.html" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/blog/Flutter/Record.html" class="nav-link">Flutter</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">技术归纳</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/HTML5/Canvas.html" class="nav-link">HTML5</a></li><li class="dropdown-item"><!----> <a href="/blog/CSS3/Background.html" class="nav-link">CSS3</a></li><li class="dropdown-item"><!----> <a href="/blog/JavaScript/Senior.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/blog/Node.js/Base.html" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/blog/Flutter/Record.html" class="nav-link">Flutter</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/Node.js/Base.html" class="sidebar-link">Node基础</a></li><li><a href="/blog/Node.js/Nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/blog/Node.js/HTTP.html" class="sidebar-link">HTTP核心模块</a></li><li><a href="/blog/Node.js/Express.html" class="sidebar-link">Express</a></li><li><a href="/blog/Node.js/MongoDB.html" class="active sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/Node.js/MongoDB.html#条件查询" class="sidebar-link">条件查询</a></li><li class="sidebar-sub-header"><a href="/blog/Node.js/MongoDB.html#分页" class="sidebar-link">分页</a></li><li class="sidebar-sub-header"><a href="/blog/Node.js/MongoDB.html#排序" class="sidebar-link">排序</a></li><li class="sidebar-sub-header"><a href="/blog/Node.js/MongoDB.html#模糊匹配" class="sidebar-link">模糊匹配</a></li><li class="sidebar-sub-header"><a href="/blog/Node.js/MongoDB.html#聚合函数" class="sidebar-link">聚合函数</a></li><li class="sidebar-sub-header"><a href="/blog/Node.js/MongoDB.html#联合查询" class="sidebar-link">联合查询</a></li><li class="sidebar-sub-header"><a href="/blog/Node.js/MongoDB.html#操作符" class="sidebar-link">操作符</a></li><li class="sidebar-sub-header"><a href="/blog/Node.js/MongoDB.html#扩展知识（使用mongodb实现附近的人）" class="sidebar-link">扩展知识（使用mongodb实现附近的人）</a></li><li class="sidebar-sub-header"><a href="/blog/Node.js/MongoDB.html#查找附近的人" class="sidebar-link">查找附近的人</a></li><li class="sidebar-sub-header"><a href="/blog/Node.js/MongoDB.html#离我最近" class="sidebar-link">离我最近</a></li></ul></li><li><a href="/blog/Node.js/Koa.html" class="sidebar-link">Koa</a></li><li><a href="/blog/Node.js/Socket.io.html" class="sidebar-link">Socket.io</a></li><li><a href="/blog/Node.js/MySQL.html" class="sidebar-link">MySQL</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="mongodb"><a href="#mongodb" aria-hidden="true" class="header-anchor">#</a> MongoDB</h1> <ul><li><p>一个数据库对应多个集合</p> <ul><li>一个集合对应多个文档对象</li> <li>在mongo中不论是db还是集合，你都无需去创建他</li> <li>直接就当他已经存在，直接Use来使用
<ul><li>use db名称;
<ul><li>接着会被切换到该db中</li> <li><code>db.要创建的集合名称.save({})</code>;这样集合就被创建了</li></ul></li></ul></li></ul></li> <li><p><strong>解决32位异常</strong>
mongod --dbpath=&quot;路径&quot; --journal --storageEngine=mmapv1</p></li> <li><p>1:启动服务器</p> <ul><li><code>mongod --dbpath &quot;D:/mongodb/db&quot;</code> // 目录一定要存在自己创建随便名称‘
<ul><li>尽量设置在非系统盘 <code>C盘生成目录是需要权限的</code></li></ul></li> <li>如果看到<code>waiting for connections on port 27017</code>说明服务已经启动</li></ul></li> <li><p>客户端连接服务器<strong>另开一个命令行</strong></p> <ul><li><code>mongo</code> 默认连接的是test数据库</li></ul></li> <li><p>查询有哪些数据库</p> <ul><li>查询数据库：<code>show dbs;</code></li> <li>切换数据库: <code>use 数据库名;</code></li></ul></li> <li><p>查询当前db下有哪些集合</p> <ul><li><code>show collections;</code></li></ul></li> <li><p>查询数据：</p> <ul><li><code>db.集合名.find();</code>  //查询出来的是文档对象 document</li> <li><code>db.users.find();</code></li></ul></li> <li><p>添加数据:</p> <ul><li><code>db.集合名.save(对象)</code> //mongo默认会给我们加入_id作为该文档对象的唯一标识</li> <li><code>db.users.save({contry:'中国',name:'小明',score:77});</code></li></ul></li> <li><p>删除数据:</p> <ul><li><code>db.集合名.remove(条件对象);</code>//条件匹配就会被删除</li> <li><code>db.users.remove({name:'小明'});</code></li> <li>如果给定一个空对像，会匹配全部</li></ul></li> <li><p>更新数据:</p> <ul><li><code>db.集合名.update({匹配条件对象},{$set:{修改后的对象}});</code></li> <li><code>db.users.update({name:'小明'},{$set:{contry:'印度'}});;</code></li></ul></li></ul> <h2 id="条件查询"><a href="#条件查询" aria-hidden="true" class="header-anchor">#</a> 条件查询</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>查询姓名为小明的学生
        db.users.find({name:'小明'});;   查询英语成绩大于90分的同学
        db.users.find({score:{$gt:90}}); //查找成绩大于90分$gt
        //$lt小于
查询数学成绩不等于88的同学
        db.users.find({score:{$ne:88}});   查询总分大于200分的所有同学
        db.users.find({score:{$gt:200}});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="分页"><a href="#分页" aria-hidden="true" class="header-anchor">#</a> 分页</h2> <ul><li><code>db.users.find().skip(3).limit(3);</code></li> <li>db.集合名称.find().跳到3.显示3条
+ limit 0,3</li></ul> <h2 id="排序"><a href="#排序" aria-hidden="true" class="header-anchor">#</a> 排序</h2> <ul><li><code>db.users.find().sort({key:排序方式});</code></li> <li><code>db.users.find().sort({'score':1});</code> //正数代表升序，负数代表降序</li></ul> <h2 id="模糊匹配"><a href="#模糊匹配" aria-hidden="true" class="header-anchor">#</a> 模糊匹配</h2> <ul><li><code>db.users.find({name:{$regex:'小'}});</code></li> <li><code>db.users.find({name:{$regex:'明'}});</code></li></ul> <h2 id="聚合函数"><a href="#聚合函数" aria-hidden="true" class="header-anchor">#</a> 聚合函数</h2> <ul><li>需要求当前集合的记录数：</li> <li><code>db.users.find().count();</code></li> <li>求最大值
-求整个集合的总成绩
+ db.集合名.聚合({ 组的划分规则{_id:'1',显示内容:{$sum:'$score'}} })
<ul><li>求所有人的平均分
<ul><li><code>db.users.aggregate({$group:{_id:'1',sumscore:{$avg:'$score' } }});</code></li></ul></li> <li>求按国家分组，求所有国家的总分
<ul><li><code>db.users.aggregate({$group:{_id:'$contry',sumScore:{$sum:'$score'}}});</code></li></ul></li></ul></li> <li>添加基础数据:
db.users.save({contry:'中国',name:'小明',score:77});
db.users.save({contry:'中国',name:'小红',score:88});
db.users.save({contry:'中国',name:'小张',score:99});
db.users.save({contry:'美国',name:'jack',score:45});
db.users.save({contry:'美国',name:'rose',score:67});
db.users.save({contry:'美国',name:'mick',score:89});</li></ul> <h2 id="联合查询"><a href="#联合查询" aria-hidden="true" class="header-anchor">#</a> 联合查询</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>orders<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;item&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;almonds&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;price&quot;</span> <span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">&quot;quantity&quot;</span> <span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;item&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;pecans&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;price&quot;</span> <span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">&quot;quantity&quot;</span> <span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token number">3</span>  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>inventory<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;sku&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;almonds&quot;</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">&quot;product 1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;instock&quot;</span> <span class="token punctuation">:</span> <span class="token number">120</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;sku&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;bread&quot;</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">&quot;product 2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;instock&quot;</span> <span class="token punctuation">:</span> <span class="token number">80</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;sku&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cashews&quot;</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">&quot;product 3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;instock&quot;</span> <span class="token punctuation">:</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;sku&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;pecans&quot;</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">&quot;product 4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;instock&quot;</span> <span class="token punctuation">:</span> <span class="token number">70</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;sku&quot;</span><span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">&quot;Incomplete&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token number">6</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>orders<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
     $lookup<span class="token punctuation">:</span>
       <span class="token punctuation">{</span>
         <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token string">&quot;inventory&quot;</span><span class="token punctuation">,</span>
         localField<span class="token punctuation">:</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span>
         foreignField<span class="token punctuation">:</span> <span class="token string">&quot;sku&quot;</span><span class="token punctuation">,</span>
         <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token string">&quot;inventory_docs&quot;</span>
       <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="操作符"><a href="#操作符" aria-hidden="true" class="header-anchor">#</a> 操作符</h2> <ul><li>https://docs.mongodb.com/manual/reference/operator/</li></ul> <h2 id="扩展知识（使用mongodb实现附近的人）"><a href="#扩展知识（使用mongodb实现附近的人）" aria-hidden="true" class="header-anchor">#</a> 扩展知识（使用mongodb实现附近的人）</h2> <p><img src="/blog/assets/img/location.0747e924.jpg" alt="location"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建索引</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;sp&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2dsphere&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span>sp<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">105.754</span><span class="token punctuation">,</span><span class="token number">41.689</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span>sp<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">105.304</span><span class="token punctuation">,</span><span class="token number">41.783</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span>sp<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">105.084</span><span class="token punctuation">,</span><span class="token number">41.389</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">,</span>sp<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">105.831</span><span class="token punctuation">,</span><span class="token number">41.285</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">&quot;E&quot;</span><span class="token punctuation">,</span>sp<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">106.128</span><span class="token punctuation">,</span><span class="token number">42.086</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">&quot;F&quot;</span><span class="token punctuation">,</span>sp<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">105.431</span><span class="token punctuation">,</span><span class="token number">42.009</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">&quot;G&quot;</span><span class="token punctuation">,</span>sp<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">104.705</span><span class="token punctuation">,</span><span class="token number">41.921</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="查找附近的人"><a href="#查找附近的人" aria-hidden="true" class="header-anchor">#</a> 查找附近的人</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>
       sp<span class="token punctuation">:</span>
         <span class="token punctuation">{</span>
          $nearSphere <span class="token punctuation">:</span>
            <span class="token punctuation">{</span>
              $geometry<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
                type<span class="token punctuation">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>  
                coordinates<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">105.304</span><span class="token punctuation">,</span><span class="token number">41.783</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              $minDistance<span class="token punctuation">:</span> <span class="token number">25000</span><span class="token punctuation">,</span>
              $maxDistance<span class="token punctuation">:</span> <span class="token number">40000</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="离我最近"><a href="#离我最近" aria-hidden="true" class="header-anchor">#</a> 离我最近</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        $geoNear<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          near<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span> coordinates<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">105.304</span><span class="token punctuation">,</span><span class="token number">41.783</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          distanceField<span class="token punctuation">:</span> <span class="token string">&quot;dist.calculated&quot;</span><span class="token punctuation">,</span>
          spherical<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
          maxDistance<span class="token punctuation">:</span> <span class="token number">40000</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><p>经纬度查询网站</p> <ul><li>http://www.gpsspg.com/maps.htm</li></ul></li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/Node.js/Express.html" class="prev">
          Express
        </a></span> <span class="next"><a href="/blog/Node.js/Koa.html">
          Koa
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/app.cd55051b.js" defer></script><script src="/blog/assets/js/8.b1c62d01.js" defer></script>
  </body>
</html>
